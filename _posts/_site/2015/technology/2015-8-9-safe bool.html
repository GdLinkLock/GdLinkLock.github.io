<!-- more -->

<h1 id="safe-bool">safe bool</h1>

<blockquote>
  <p>解决问题：类型重载所带来的诡异表达式
原理：类型重载
好处：编译期发现不合适的转型</p>
</blockquote>

<p>```
class Test1
{
public:
	bool IsValid(){return true;}
};</p>

<p>class Test2
{
public:
	operator bool(){return true;}
};</p>

<p>class Test3
{
public:
	operator void*(){return this;}
};</p>

<p>class Test4
{
private:
	struct dummy   {void nonnull() {};};
	typedef void (dummy::*safe_bool)();
	const bool empty() const {return false;}
public:
	operator safe_bool () const
	{
		return (this-&gt;empty())? 0 : &amp;dummy::nonnull; 
	}
};
int main()
{
	Test1 t1;
	if(t1.IsValid())
	{
		//需要显示调用IsValid
	}</p>

<pre><code>Test2 t2;
if(t2)
{
	int tmpVal=t2;//重载运算符，将一个对象赋值给一个int，什么行为？
}

Test3 t3;
if(t3)
{
	delete t3;//重载void*，将一个对象delete，什么行为？
}

Test4 t4;
if(t4)
{
	int tmpVal=t4;//error，编译期报错
	delete t4;//error，编译期报错
}
return 0; } ```
</code></pre>
